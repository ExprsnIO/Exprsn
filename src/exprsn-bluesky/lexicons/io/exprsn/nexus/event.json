{
  "lexicon": 1,
  "id": "io.exprsn.nexus.event",
  "defs": {
    "main": {
      "type": "record",
      "description": "Event record with CalDAV support",
      "key": "tid",
      "record": {
        "type": "object",
        "required": ["title", "startTime", "createdAt"],
        "properties": {
          "title": {
            "type": "string",
            "maxLength": 200
          },
          "description": {
            "type": "string",
            "maxLength": 5000
          },
          "location": {
            "type": "ref",
            "ref": "#eventLocation"
          },
          "startTime": {
            "type": "string",
            "format": "datetime"
          },
          "endTime": {
            "type": "string",
            "format": "datetime"
          },
          "timezone": {
            "type": "string",
            "description": "IANA timezone identifier"
          },
          "isAllDay": {
            "type": "boolean",
            "default": false
          },
          "recurrence": {
            "type": "ref",
            "ref": "#recurrenceRule"
          },
          "visibility": {
            "type": "string",
            "enum": ["public", "private", "followers"],
            "default": "public"
          },
          "groupId": {
            "type": "string",
            "format": "at-uri",
            "description": "Associated group (optional)"
          },
          "maxAttendees": {
            "type": "integer",
            "description": "Maximum number of attendees"
          },
          "requiresApproval": {
            "type": "boolean",
            "default": false
          },
          "createdAt": {
            "type": "string",
            "format": "datetime"
          }
        }
      }
    },
    "eventLocation": {
      "type": "object",
      "properties": {
        "type": {
          "type": "string",
          "enum": ["physical", "virtual", "hybrid"]
        },
        "name": {
          "type": "string",
          "maxLength": 200
        },
        "address": {
          "type": "string",
          "maxLength": 500
        },
        "coordinates": {
          "type": "ref",
          "ref": "#coordinates"
        },
        "virtualUrl": {
          "type": "string",
          "format": "uri"
        }
      }
    },
    "coordinates": {
      "type": "object",
      "required": ["latitude", "longitude"],
      "properties": {
        "latitude": {
          "type": "number",
          "minimum": -90,
          "maximum": 90
        },
        "longitude": {
          "type": "number",
          "minimum": -180,
          "maximum": 180
        }
      }
    },
    "recurrenceRule": {
      "type": "object",
      "description": "iCal RRULE format",
      "required": ["frequency"],
      "properties": {
        "frequency": {
          "type": "string",
          "enum": ["DAILY", "WEEKLY", "MONTHLY", "YEARLY"]
        },
        "interval": {
          "type": "integer",
          "minimum": 1
        },
        "count": {
          "type": "integer",
          "description": "Number of occurrences"
        },
        "until": {
          "type": "string",
          "format": "datetime"
        },
        "byDay": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": ["MO", "TU", "WE", "TH", "FR", "SA", "SU"]
          }
        }
      }
    },
    "view": {
      "type": "object",
      "required": ["uri", "cid", "title", "organizer", "startTime", "createdAt"],
      "properties": {
        "uri": {
          "type": "string",
          "format": "at-uri"
        },
        "cid": {
          "type": "string",
          "format": "cid"
        },
        "title": {
          "type": "string"
        },
        "description": {
          "type": "string"
        },
        "location": {
          "type": "ref",
          "ref": "#eventLocation"
        },
        "organizer": {
          "type": "ref",
          "ref": "app.bsky.actor.defs#profileViewBasic"
        },
        "startTime": {
          "type": "string",
          "format": "datetime"
        },
        "endTime": {
          "type": "string",
          "format": "datetime"
        },
        "attendeeCount": {
          "type": "integer"
        },
        "maxAttendees": {
          "type": "integer"
        },
        "visibility": {
          "type": "string"
        },
        "viewer": {
          "type": "ref",
          "ref": "#viewerState"
        },
        "createdAt": {
          "type": "string",
          "format": "datetime"
        }
      }
    },
    "viewerState": {
      "type": "object",
      "properties": {
        "attending": {
          "type": "boolean"
        },
        "response": {
          "type": "string",
          "enum": ["going", "maybe", "notGoing"]
        },
        "respondedAt": {
          "type": "string",
          "format": "datetime"
        }
      }
    }
  }
}
