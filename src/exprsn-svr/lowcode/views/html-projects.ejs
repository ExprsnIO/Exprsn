<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML Projects - Exprsn Low-Code Platform</title>

  <!-- Exprsn Theme -->
  <link rel="stylesheet" href="/css/lowcode-theme.css">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: var(--bg-primary, #ffffff);
      color: var(--text-primary, #212529);
      transition: background-color 0.3s ease, color 0.3s ease;
    }

    .app-container {
      display: flex;
      flex-direction: column;
      height: 100vh;
      overflow: hidden;
    }

    /* Header */
    .app-header {
      background: var(--bg-secondary);
      border-bottom: 1px solid var(--border-color);
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      box-shadow: var(--shadow-sm);
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    .header-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
    }

    .breadcrumb {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.875rem;
      color: var(--text-secondary);
    }

    .breadcrumb a {
      color: var(--primary, #0d6efd);
      text-decoration: none;
      transition: color 0.2s ease;
    }

    .breadcrumb a:hover {
      color: var(--primary-dark, #0b5ed7);
      text-decoration: underline;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 1rem;
    }

    /* Main Content */
    .main-content {
      flex: 1;
      overflow-y: auto;
      padding: 2rem;
    }

    /* Toolbar */
    .toolbar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 2rem;
      gap: 1rem;
      flex-wrap: wrap;
    }

    .toolbar-left {
      display: flex;
      gap: 1rem;
      align-items: center;
      flex: 1;
    }

    .search-box {
      position: relative;
      flex: 1;
      max-width: 400px;
    }

    .search-box input {
      width: 100%;
      padding: 0.625rem 0.875rem 0.625rem 2.5rem;
      border: 1px solid var(--border-color, #dee2e6);
      border-radius: 8px;
      background: var(--bg-primary, #ffffff);
      color: var(--text-primary, #212529);
      font-size: 0.875rem;
      transition: border-color 0.2s ease;
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--primary, #0d6efd);
      box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
    }

    .search-box i {
      position: absolute;
      left: 0.875rem;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-secondary);
    }

    .filter-dropdown {
      position: relative;
    }

    .filter-dropdown select {
      padding: 0.625rem 2.5rem 0.625rem 0.875rem;
      border: 1px solid var(--border-color, #dee2e6);
      border-radius: 8px;
      background: var(--bg-primary, #ffffff);
      color: var(--text-primary, #212529);
      font-size: 0.875rem;
      cursor: pointer;
      transition: border-color 0.2s ease;
    }

    .filter-dropdown select:focus {
      outline: none;
      border-color: var(--primary, #0d6efd);
    }

    /* Buttons */
    .btn {
      padding: 0.625rem 1.25rem;
      border: none;
      border-radius: 8px;
      font-size: 0.875rem;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s ease;
      display: inline-flex;
      align-items: center;
      gap: 0.5rem;
    }

    .btn:disabled {
      opacity: 0.65;
      cursor: not-allowed;
      pointer-events: none;
    }

    .btn-primary:disabled {
      background: var(--gray-400, #ced4da);
    }

    .btn-primary {
      background: var(--primary, #0d6efd);
      color: white;
      font-weight: 600;
    }

    .btn-primary:hover {
      background: var(--primary-dark, #0b5ed7);
      transform: translateY(-1px);
      box-shadow: var(--shadow, 0 0.5rem 1rem rgba(0, 0, 0, 0.15));
    }

    .btn-primary:active {
      background: var(--primary-dark, #0b5ed7);
      transform: translateY(0);
    }

    .btn-secondary {
      background: var(--gray-200, #e9ecef);
      color: var(--text-primary, #212529);
      font-weight: 600;
    }

    .btn-secondary:hover {
      background: var(--gray-300, #dee2e6);
    }

    .btn-secondary:active {
      background: var(--gray-400, #ced4da);
    }

    /* Projects Grid */
    .projects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 1.5rem;
    }

    .project-card {
      background: var(--bg-secondary);
      border: 1px solid var(--border-color);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      overflow: hidden;
    }

    .project-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-lg, 0 1rem 3rem rgba(0, 0, 0, 0.175));
      border-color: var(--primary, #0d6efd);
    }

    .project-card-header {
      display: flex;
      justify-content: space-between;
      align-items: start;
      margin-bottom: 1rem;
    }

    .project-icon {
      width: 48px;
      height: 48px;
      border-radius: 8px;
      background: linear-gradient(135deg, var(--primary, #0d6efd), var(--primary-dark, #0b5ed7));
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
    }

    .project-status {
      padding: 0.25rem 0.75rem;
      border-radius: 999px;
      font-size: 0.75rem;
      font-weight: 600;
      text-transform: capitalize;
    }

    .status-draft { background: #e9ecef; color: #495057; }
    .status-development { background: #cfe2ff; color: #052c65; }
    .status-staging { background: #fff3cd; color: #664d03; }
    .status-production { background: #d1e7dd; color: #0a3622; }
    .status-archived { background: #f8d7da; color: #58151c; }

    .project-title {
      font-size: 1.125rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
      color: var(--text-primary);
    }

    .project-description {
      font-size: 0.875rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
      line-height: 1.5;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .project-meta {
      display: flex;
      gap: 1.5rem;
      font-size: 0.75rem;
      color: var(--text-secondary);
      margin-bottom: 1rem;
    }

    .project-meta-item {
      display: flex;
      align-items: center;
      gap: 0.375rem;
    }

    .project-actions {
      display: flex;
      gap: 0.5rem;
      padding-top: 1rem;
      border-top: 1px solid var(--border-color);
    }

    .project-action-btn {
      flex: 1;
      padding: 0.5rem;
      border: none;
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border-radius: var(--radius-sm);
      font-size: 0.875rem;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .project-action-btn:hover {
      background: var(--primary, #0d6efd);
      color: white;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 4rem 2rem;
    }

    .empty-state-icon {
      font-size: 4rem;
      color: var(--gray-400);
      margin-bottom: 1rem;
    }

    .empty-state-title {
      font-size: 1.5rem;
      font-weight: 600;
      color: var(--text-primary);
      margin-bottom: 0.5rem;
    }

    .empty-state-description {
      font-size: 1rem;
      color: var(--text-secondary);
      margin-bottom: 2rem;
    }

    /* Modal */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.6);
      z-index: 9999;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(2px);
      animation: fadeIn 0.2s ease;
    }

    .modal.active {
      display: flex;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    .modal-content {
      background: var(--bg-secondary, #f8f9fa);
      border-radius: 12px;
      padding: 2rem;
      max-width: 500px;
      width: 90%;
      max-height: 90vh;
      overflow-y: auto;
      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: var(--text-secondary, #6c757d);
      transition: color 0.2s ease, transform 0.2s ease;
      width: 32px;
      height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
    }

    .modal-close:hover {
      color: var(--danger, #dc3545);
      background: rgba(220, 53, 69, 0.1);
      transform: scale(1.1);
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      font-size: 0.875rem;
    }

    .form-input, .form-textarea, .form-select {
      width: 100%;
      padding: 0.75rem;
      border: 1px solid var(--border-color, #dee2e6);
      border-radius: 8px;
      background: var(--bg-primary, #ffffff);
      color: var(--text-primary, #212529);
      font-size: 0.875rem;
      font-family: inherit;
      transition: border-color 0.2s ease;
    }

    .form-input:focus, .form-textarea:focus, .form-select:focus {
      outline: none;
      border-color: var(--primary, #0d6efd);
      box-shadow: 0 0 0 3px rgba(13, 110, 253, 0.1);
    }

    .form-textarea {
      min-height: 100px;
      resize: vertical;
    }

    .form-actions {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
    }

    /* Loading State */
    .loading {
      text-align: center;
      padding: 4rem 2rem;
    }

    .spinner {
      width: 48px;
      height: 48px;
      border: 4px solid var(--gray-300, #dee2e6);
      border-top-color: var(--primary, #0d6efd);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin: 0 auto 1rem;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Font Awesome spinner animation */
    .fa-spin {
      animation: fa-spin 1s linear infinite;
    }

    @keyframes fa-spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }
  </style>
</head>
<body>
  <div class="app-container">
    <!-- Header -->
    <header class="app-header">
      <div class="header-left">
        <h1 class="header-title">HTML Projects</h1>
        <div class="breadcrumb">
          <a href="/lowcode"><i class="fas fa-home"></i> Low-Code</a>
          <i class="fas fa-chevron-right"></i>
          <span>HTML Projects</span>
        </div>
      </div>
      <div class="header-right">
        <button class="btn btn-primary" onclick="showCreateModal()">
          <i class="fas fa-plus"></i>
          New Project
        </button>
      </div>
    </header>

    <!-- Main Content -->
    <main class="main-content">
      <!-- Toolbar -->
      <div class="toolbar">
        <div class="toolbar-left">
          <div class="search-box">
            <i class="fas fa-search"></i>
            <input type="text" id="searchInput" placeholder="Search projects..." onkeyup="filterProjects()">
          </div>
          <div class="filter-dropdown">
            <select id="statusFilter" onchange="filterProjects()">
              <option value="">All Status</option>
              <option value="draft">Draft</option>
              <option value="development">Development</option>
              <option value="staging">Staging</option>
              <option value="production">Production</option>
              <option value="archived">Archived</option>
            </select>
          </div>
        </div>
      </div>

      <!-- Projects Grid -->
      <div id="projectsContainer">
        <div class="loading">
          <div class="spinner"></div>
          <p>Loading projects...</p>
        </div>
      </div>
    </main>
  </div>

  <!-- Create Project Modal -->
  <div id="createModal" class="modal" onclick="handleModalBackdropClick(event)">
    <div class="modal-content" onclick="event.stopPropagation()">
      <div class="modal-header">
        <h2 class="modal-title">Create HTML Project</h2>
        <button class="modal-close" onclick="hideCreateModal()">&times;</button>
      </div>
      <form id="createForm">
        <div class="form-group">
          <label class="form-label" for="projectName">Project Name *</label>
          <input type="text" id="projectName" class="form-input" required minlength="1" maxlength="100">
        </div>
        <div class="form-group">
          <label class="form-label" for="projectDescription">Description</label>
          <textarea id="projectDescription" class="form-textarea" maxlength="500"></textarea>
        </div>
        <div class="form-actions">
          <button type="button" class="btn btn-secondary" id="cancelBtn">Cancel</button>
          <button type="submit" class="btn btn-primary" id="createProjectBtn">
            <i class="fas fa-plus"></i>
            Create Project
          </button>
        </div>
      </form>
    </div>
  </div>

  <script>
    let projects = [];
    const OWNER_ID = '00000000-0000-0000-0000-000000000001'; // TODO: Get from session

    // Initialize event listeners
    window.addEventListener('DOMContentLoaded', () => {
      console.log('[DOMContentLoaded] Page loaded, initializing...');

      // Load projects
      loadProjects();

      // Form submit handler
      const createForm = document.getElementById('createForm');
      if (createForm) {
        console.log('[DOMContentLoaded] Attaching submit handler to createForm');
        createForm.addEventListener('submit', createProject);
      } else {
        console.error('[DOMContentLoaded] createForm not found!');
      }

      // Cancel button
      const cancelBtn = document.getElementById('cancelBtn');
      if (cancelBtn) {
        console.log('[DOMContentLoaded] Attaching click handler to cancelBtn');
        cancelBtn.addEventListener('click', hideCreateModal);
      } else {
        console.error('[DOMContentLoaded] cancelBtn not found!');
      }
    });

    // Close modal on Escape key
    document.addEventListener('keydown', (event) => {
      if (event.key === 'Escape') {
        const modal = document.getElementById('createModal');
        if (modal && modal.classList.contains('active')) {
          hideCreateModal();
        }
      }
    });

    async function loadProjects() {
      try {
        console.log('[loadProjects] Fetching projects from /lowcode/api/html-projects');
        const response = await fetch('/lowcode/api/html-projects');
        console.log('[loadProjects] Response status:', response.status);
        console.log('[loadProjects] Response headers:', Object.fromEntries(response.headers.entries()));

        const result = await response.json();
        console.log('[loadProjects] Response data:', result);

        if (result.success) {
          projects = result.data.projects;
          console.log('[loadProjects] Loaded', projects.length, 'projects');
          renderProjects();
        } else {
          console.error('[loadProjects] API returned error:', result);
          showError('Failed to load projects: ' + (result.message || result.error || 'Unknown error'));
        }
      } catch (error) {
        console.error('[loadProjects] Exception caught:', error);
        console.error('[loadProjects] Error stack:', error.stack);
        showError('Failed to load projects: ' + error.message);
      }
    }

    function renderProjects() {
      console.log('[renderProjects] Rendering', projects.length, 'projects');
      const container = document.getElementById('projectsContainer');

      if (!container) {
        console.error('[renderProjects] Container element not found!');
        return;
      }

      if (projects.length === 0) {
        console.log('[renderProjects] No projects, showing empty state');
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"><i class="fas fa-folder-open"></i></div>
            <h2 class="empty-state-title">No HTML Projects Yet</h2>
            <p class="empty-state-description">Create your first HTML project to get started building web applications</p>
            <button class="btn btn-primary" onclick="showCreateModal()">
              <i class="fas fa-plus"></i>
              Create Your First Project
            </button>
          </div>
        `;
        return;
      }

      const html = `
        <div class="projects-grid">
          ${projects.map(project => `
            <div class="project-card" onclick="openProject('${project.id}')">
              <div class="project-card-header">
                <div class="project-icon">
                  <i class="fas fa-code"></i>
                </div>
                <span class="project-status status-${project.status}">${project.status}</span>
              </div>
              <h3 class="project-title">${escapeHtml(project.name)}</h3>
              <p class="project-description">${escapeHtml(project.description || 'No description')}</p>
              <div class="project-meta">
                <div class="project-meta-item">
                  <i class="fas fa-clock"></i>
                  <span>${formatDate(project.updatedAt)}</span>
                </div>
              </div>
              <div class="project-actions">
                <button class="project-action-btn" onclick="openIDE('${project.id}'); event.stopPropagation();" style="background: linear-gradient(135deg, #1e88e5 0%, #1565c0 100%); color: white;">
                  <i class="fas fa-laptop-code"></i> Full IDE
                </button>
                <button class="project-action-btn" onclick="openVisualDesignerPro('${project.id}'); event.stopPropagation();" style="background: linear-gradient(135deg, #7c3aed 0%, #5b21b6 100%); color: white;" title="Professional WYSIWYG Designer with 60+ components, entity/chart integration, and collapsible panels">
                  <i class="fas fa-wand-magic-sparkles"></i> Designer Pro
                </button>
                <button class="project-action-btn" onclick="openVisualDesigner('${project.id}'); event.stopPropagation();" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                  <i class="fas fa-magic"></i> Visual Builder
                </button>
                <button class="project-action-btn" onclick="openProject('${project.id}'); event.stopPropagation();">
                  <i class="fas fa-code"></i> Code Editor
                </button>
                <button class="project-action-btn" onclick="duplicateProject('${project.id}'); event.stopPropagation();">
                  <i class="fas fa-copy"></i> Duplicate
                </button>
                <button class="project-action-btn" onclick="deleteProject('${project.id}'); event.stopPropagation();">
                  <i class="fas fa-trash"></i> Delete
                </button>
              </div>
            </div>
          `).join('')}
        </div>
      `;

      container.innerHTML = html;
    }

    function filterProjects() {
      const search = document.getElementById('searchInput').value.toLowerCase();
      const status = document.getElementById('statusFilter').value;

      const filtered = projects.filter(project => {
        const matchesSearch = project.name.toLowerCase().includes(search) ||
                            (project.description || '').toLowerCase().includes(search);
        const matchesStatus = !status || project.status === status;
        return matchesSearch && matchesStatus;
      });

      const container = document.getElementById('projectsContainer');
      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <div class="empty-state-icon"><i class="fas fa-search"></i></div>
            <h2 class="empty-state-title">No Projects Found</h2>
            <p class="empty-state-description">Try adjusting your search or filters</p>
          </div>
        `;
      } else {
        // Render filtered projects (simplified for brevity)
        const tempProjects = projects;
        projects = filtered;
        renderProjects();
        projects = tempProjects;
      }
    }

    function showCreateModal() {
      console.log('[showCreateModal] Opening modal');
      const modal = document.getElementById('createModal');
      if (!modal) {
        console.error('[showCreateModal] Modal element not found!');
        return;
      }
      modal.classList.add('active');
      setTimeout(() => {
        const nameInput = document.getElementById('projectName');
        if (nameInput) {
          nameInput.focus();
          console.log('[showCreateModal] Focused on name input');
        }
      }, 100);
    }

    function hideCreateModal() {
      document.getElementById('createModal').classList.remove('active');
      document.getElementById('createForm').reset();
      // Reset button state
      const submitBtn = document.querySelector('#createForm button[type="submit"]');
      if (submitBtn) {
        submitBtn.disabled = false;
        submitBtn.innerHTML = '<i class="fas fa-plus"></i> Create Project';
      }
    }

    function handleModalBackdropClick(event) {
      // Only close if clicking directly on the modal backdrop, not its children
      if (event.target.id === 'createModal') {
        hideCreateModal();
      }
    }

    async function createProject(event) {
      event.preventDefault();
      event.stopPropagation();

      console.log('[createProject] Function triggered');

      const nameInput = document.getElementById('projectName');
      const descriptionInput = document.getElementById('projectDescription');
      const submitBtn = document.getElementById('createProjectBtn');

      if (!nameInput || !descriptionInput || !submitBtn) {
        console.error('[createProject] Missing form elements');
        return false;
      }

      const name = nameInput.value.trim();
      const description = descriptionInput.value.trim();

      console.log('[createProject] Form data:', { name, description });

      // Validate
      if (!name) {
        alert('Please enter a project name');
        nameInput.focus();
        return false;
      }

      // Disable button and show loading state
      submitBtn.disabled = true;
      const originalHTML = submitBtn.innerHTML;
      submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Creating...';

      try {
        console.log('[createProject] Sending POST to /lowcode/api/html-projects');

        const requestBody = {
          name,
          description,
          ownerId: OWNER_ID
        };

        console.log('[createProject] Request body:', JSON.stringify(requestBody));

        const response = await fetch('/lowcode/api/html-projects', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(requestBody)
        });

        console.log('[createProject] Response status:', response.status);

        const result = await response.json();
        console.log('[createProject] Response data:', result);

        if (result.success) {
          console.log('[createProject] Success! Closing modal and reloading projects');
          hideCreateModal();
          await loadProjects();
        } else {
          console.error('[createProject] Server returned error:', result.message);
          alert('Failed to create project: ' + (result.message || 'Unknown error'));
          submitBtn.disabled = false;
          submitBtn.innerHTML = originalHTML;
        }
      } catch (error) {
        console.error('[createProject] Exception:', error);
        alert('Failed to create project: ' + error.message);
        submitBtn.disabled = false;
        submitBtn.innerHTML = originalHTML;
      }

      return false;
    }

    function openProject(projectId) {
      window.location.href = `/lowcode/html-designer?projectId=${projectId}`;
    }

    function openVisualDesigner(projectId) {
      window.location.href = `/lowcode/html-visual-designer?projectId=${projectId}`;
    }

    function openVisualDesignerPro(projectId) {
      window.location.href = `/lowcode/html-visual-designer-pro?projectId=${projectId}`;
    }

    function openIDE(projectId) {
      window.location.href = `/lowcode/html-ide?projectId=${projectId}`;
    }

    async function duplicateProject(projectId) {
      if (!confirm('Duplicate this project?')) return;

      try {
        const response = await fetch(`/lowcode/api/html-projects/${projectId}/duplicate`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ ownerId: OWNER_ID })
        });

        const result = await response.json();

        if (result.success) {
          loadProjects();
        } else {
          alert('Failed to duplicate project: ' + result.message);
        }
      } catch (error) {
        console.error('Error duplicating project:', error);
        alert('Failed to duplicate project');
      }
    }

    async function deleteProject(projectId) {
      if (!confirm('Are you sure you want to delete this project? This action cannot be undone.')) return;

      try {
        const response = await fetch(`/lowcode/api/html-projects/${projectId}`, {
          method: 'DELETE'
        });

        const result = await response.json();

        if (result.success) {
          loadProjects();
        } else {
          alert('Failed to delete project: ' + result.message);
        }
      } catch (error) {
        console.error('Error deleting project:', error);
        alert('Failed to delete project');
      }
    }

    function formatDate(dateString) {
      const date = new Date(dateString);
      const now = new Date();
      const diff = now - date;
      const days = Math.floor(diff / (1000 * 60 * 60 * 24));

      if (days === 0) return 'Today';
      if (days === 1) return 'Yesterday';
      if (days < 7) return `${days} days ago`;
      return date.toLocaleDateString();
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function showError(message) {
      const container = document.getElementById('projectsContainer');
      container.innerHTML = `
        <div class="empty-state">
          <div class="empty-state-icon"><i class="fas fa-exclamation-triangle"></i></div>
          <h2 class="empty-state-title">Error</h2>
          <p class="empty-state-description">${message}</p>
          <button class="btn btn-primary" onclick="loadProjects()">
            <i class="fas fa-redo"></i>
            Try Again
          </button>
        </div>
      `;
    }
  </script>
</body>
</html>
