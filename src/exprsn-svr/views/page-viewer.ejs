<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%- page.title %></title>
  <% if (page.description) { %>
  <meta name="description" content="<%- page.description %>">
  <% } %>
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <% if (page.css_content) { %>
  <style><%- page.css_content %></style>
  <% } %>
</head>
<body>
  <%-page.html_content %>
  
  <script>
    // Server data available to client-side code
    const serverData = <%-JSON.stringify(serverData) %>;
    const pageId = '<%- page.id %>';
  </script>
  
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  
  <% if (page.socket_events && page.socket_events.length > 0) { %>
  <script src="/socket.io/socket.io.js"></script>
  <script>
    // Initialize Socket.IO connection
    const socket = io();
    
    // Join page room
    socket.emit('page:join', { pageId });
    
    // Listen for configured events
    const socketEvents = <%-JSON.stringify(page.socket_events) %>;
    socketEvents.forEach(eventName => {
      socket.on(eventName, (data) => {
        console.log('Socket event received:', eventName, data);
        // Trigger custom event for user code to handle
        window.dispatchEvent(new CustomEvent('socket:' + eventName, { detail: data }));
      });
    });
  </script>
  <% } %>
  
  <% if (page.javascript_content) { %>
  <script><%- page.javascript_content %></script>
  <% } %>
</body>
</html>
