<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= mode === 'create' ? 'Create New Page' : 'Edit Page' %> - Exprsn Editor</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    body { overflow: hidden; }
    .editor-container { height: calc(100vh - 56px); display: flex; flex-direction: column; }
    .editor-header { background: #f8f9fa; border-bottom: 1px solid #dee2e6; padding: 1rem; }
    .editor-tabs { border-bottom: 1px solid #dee2e6; background: #fff; }
    .editor-tabs .nav-link { border: none; border-bottom: 3px solid transparent; color: #6c757d; }
    .editor-tabs .nav-link.active { border-bottom-color: #0d6efd; color: #0d6efd; font-weight: 500; }
    .editor-wrapper { flex: 1; display: flex; overflow: hidden; }
    .monaco-editor-wrapper { flex: 1; min-height: 0; }
    .preview-pane { flex: 1; border-left: 1px solid #dee2e6; background: #fff; overflow: auto; }
    .btn-toolbar { gap: 0.5rem; }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-dark">
    <div class="container-fluid">
      <span class="navbar-brand mb-0 h1">
        <i class="bi bi-code-square"></i>
        <%= mode === 'create' ? 'Create New Page' : 'Edit: ' + (page ? page.title : '') %>
      </span>
      <div class="d-flex gap-2">
        <button id="saveBtn" class="btn btn-success">
          <i class="bi bi-save"></i> Save
        </button>
        <button id="previewBtn" class="btn btn-primary">
          <i class="bi bi-eye"></i> <span id="previewText">Show Preview</span>
        </button>
        <a href="/editor" class="btn btn-outline-light">
          <i class="bi bi-x-lg"></i> Close
        </a>
      </div>
    </div>
  </nav>

  <div class="editor-container">
    <!-- Page Settings -->
    <div class="editor-header">
      <div class="row g-3">
        <div class="col-md-4">
          <label for="pageTitle" class="form-label">Page Title</label>
          <input type="text" class="form-control" id="pageTitle" 
                 value="<%= page ? page.title : '' %>" required>
        </div>
        <div class="col-md-3">
          <label for="pageSlug" class="form-label">URL Slug</label>
          <input type="text" class="form-control" id="pageSlug" 
                 value="<%= page ? page.slug : '' %>" required>
        </div>
        <div class="col-md-2">
          <label for="pageStatus" class="form-label">Status</label>
          <select class="form-select" id="pageStatus">
            <option value="draft" <%= page && page.status === 'draft' ? 'selected' : '' %>>Draft</option>
            <option value="published" <%= page && page.status === 'published' ? 'selected' : '' %>>Published</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label d-block">Options</label>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" id="isStatic"
                   <%= page && page.is_static ? 'checked' : '' %>>
            <label class="form-check-label" for="isStatic">Static</label>
          </div>
          <div class="form-check form-check-inline">
            <input class="form-check-input" type="checkbox" id="isPublic"
                   <%= page && page.is_public ? 'checked' : '' %>>
            <label class="form-check-label" for="isPublic">Public</label>
          </div>
        </div>
      </div>
    </div>

    <!-- Editor Tabs -->
    <ul class="nav nav-tabs editor-tabs" role="tablist">
      <li class="nav-item">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#htmlTab" 
                data-editor="html">HTML</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#cssTab"
                data-editor="css">CSS</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#jsTab"
                data-editor="javascript">JavaScript</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#serverTab"
                data-editor="serverCode">Server Code</button>
      </li>
      <li class="nav-item">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#settingsTab"
                data-editor="settings">Settings</button>
      </li>
    </ul>

    <!-- Editor Area -->
    <div class="editor-wrapper">
      <div class="tab-content w-100">
        <div class="tab-pane fade show active h-100" id="htmlTab">
          <div id="htmlEditor" class="monaco-editor-wrapper"></div>
        </div>
        <div class="tab-pane fade h-100" id="cssTab">
          <div id="cssEditor" class="monaco-editor-wrapper"></div>
        </div>
        <div class="tab-pane fade h-100" id="jsTab">
          <div id="jsEditor" class="monaco-editor-wrapper"></div>
        </div>
        <div class="tab-pane fade h-100" id="serverTab">
          <div id="serverEditor" class="monaco-editor-wrapper"></div>
        </div>
        <div class="tab-pane fade h-100" id="settingsTab">
          <div class="p-4">
            <h5>Socket.IO Events</h5>
            <textarea id="socketEvents" class="form-control mb-3" rows="3"
                      placeholder='["event1", "event2"]'><%= page && page.socket_events ? JSON.stringify(page.socket_events) : '[]' %></textarea>
            
            <h5>API Routes</h5>
            <textarea id="apiRoutes" class="form-control mb-3" rows="3"
                      placeholder='["/api/route1", "/api/route2"]'><%= page && page.api_routes ? JSON.stringify(page.api_routes) : '[]' %></textarea>
            
            <h5>Page Data (JSON)</h5>
            <div id="pageDataEditor" style="height: 300px;"></div>
          </div>
        </div>
      </div>

      <!-- Preview Pane -->
      <div id="previewPane" class="preview-pane" style="display: none;">
        <iframe id="previewFrame" style="width: 100%; height: 100%; border: none;"></iframe>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.44.0/min/vs/loader.js"></script>
  <script src="/static/js/editor.js"></script>
  
  <script>
    // Pass page data to editor
    window.pageData = <%- JSON.stringify(page) %>;
    window.editorMode = '<%= mode %>';
  </script>
</body>
</html>
