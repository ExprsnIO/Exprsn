# ═══════════════════════════════════════════════════════════════════════
# Exprsn Setup Service Configuration
# Service discovery, health monitoring, and configuration management
# ═══════════════════════════════════════════════════════════════════════

# Application
NODE_ENV=development
PORT=3015

# Health Check Interval (milliseconds)
HEALTH_CHECK_INTERVAL=5000

# Database Configuration (for management operations)
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=

# Redis Configuration (optional, for caching)
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=

# Logging
LOG_LEVEL=info
LOG_FILE=./logs/exprsn-setup.log

# CORS (comma-separated origins)
CORS_ORIGINS=*

# Security
# Set to true in production
HELMET_ENABLED=true

# ═══════════════════════════════════════════════════════════════════════
# BUSINESS SERVICE CONFIGURATION (exprsn-forge)
# Comprehensive configuration for CRM, ERP, and Groupware modules
# ═══════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────
# Service Integration Endpoints
# ───────────────────────────────────────────────────────────────────────

# Core Exprsn Services
FORGE_CA_SERVICE_URL=http://localhost:3000
FORGE_AUTH_SERVICE_URL=http://localhost:3001
FORGE_TIMELINE_SERVICE_URL=http://localhost:3004
FORGE_NEXUS_SERVICE_URL=http://localhost:3011
FORGE_SPARK_SERVICE_URL=http://localhost:3002
FORGE_HERALD_SERVICE_URL=http://localhost:3014
FORGE_FILEVAULT_SERVICE_URL=http://localhost:3007
FORGE_PULSE_SERVICE_URL=http://localhost:3012

# ───────────────────────────────────────────────────────────────────────
# WebDAV Configuration
# RFC 4918 - HTTP Extensions for Web Distributed Authoring and Versioning
# ───────────────────────────────────────────────────────────────────────

FORGE_WEBDAV_ENABLED=true
FORGE_WEBDAV_PATH=/webdav
FORGE_WEBDAV_PORT=                     # Optional: Dedicated port for WebDAV
FORGE_WEBDAV_AUTH_REQUIRED=true
FORGE_WEBDAV_DIGEST_AUTH=true          # Enable Digest authentication (RFC 7616)
FORGE_WEBDAV_LOCK_ENABLED=true         # Enable WebDAV locking (RFC 4918)
FORGE_WEBDAV_LOCK_TIMEOUT=3600         # Lock timeout in seconds
FORGE_WEBDAV_MAX_FILE_SIZE=104857600   # 100MB default
FORGE_WEBDAV_QUOTA_ENABLED=true
FORGE_WEBDAV_DEFAULT_QUOTA=10737418240 # 10GB default per user
FORGE_WEBDAV_VERSIONING=true           # Enable DeltaV (RFC 3253)
FORGE_WEBDAV_SEARCH_ENABLED=true       # Enable DASL (RFC 5323)
FORGE_WEBDAV_CORS_ENABLED=true

# ───────────────────────────────────────────────────────────────────────
# CalDAV Configuration
# RFC 4791 - Calendaring Extensions to WebDAV
# ───────────────────────────────────────────────────────────────────────

FORGE_CALDAV_ENABLED=true
FORGE_CALDAV_PATH=/caldav
FORGE_CALDAV_URL=http://localhost:3016/caldav
FORGE_CALDAV_PORT=                              # Optional: Dedicated port
FORGE_CALDAV_PRINCIPAL_PATH=/caldav/principals
FORGE_CALDAV_CALENDAR_HOME=/caldav/calendars
FORGE_CALDAV_AUTH_REQUIRED=true
FORGE_CALDAV_DIGEST_AUTH=true
FORGE_CALDAV_TIMEZONE=UTC
FORGE_CALDAV_MAX_RESOURCE_SIZE=10485760         # 10MB max per calendar resource
FORGE_CALDAV_MAX_INSTANCES=1000                 # Max instances per recurring event
FORGE_CALDAV_SCHEDULING_ENABLED=true            # RFC 6638 - CalDAV Scheduling
FORGE_CALDAV_FREEBUSY_ENABLED=true              # Enable free/busy lookups
FORGE_CALDAV_SYNC_TOKEN=true                    # RFC 6578 - Collection Synchronization
FORGE_CALDAV_CALENDAR_PROXY=true                # Calendar proxy support
FORGE_CALDAV_SUBSCRIPTIONS=true                 # Calendar subscriptions (webcal://)
FORGE_CALDAV_NOTIFICATIONS=true                 # Calendar notifications
FORGE_CALDAV_MANAGED_ATTACHMENTS=true           # Managed attachments support

# ───────────────────────────────────────────────────────────────────────
# CardDAV Configuration
# RFC 6352 - CardDAV: vCard Extensions to WebDAV
# ───────────────────────────────────────────────────────────────────────

FORGE_CARDDAV_ENABLED=true
FORGE_CARDDAV_PATH=/carddav
FORGE_CARDDAV_URL=http://localhost:3016/carddav
FORGE_CARDDAV_PORT=                              # Optional: Dedicated port
FORGE_CARDDAV_PRINCIPAL_PATH=/carddav/principals
FORGE_CARDDAV_ADDRESSBOOK_HOME=/carddav/addressbooks
FORGE_CARDDAV_AUTH_REQUIRED=true
FORGE_CARDDAV_DIGEST_AUTH=true
FORGE_CARDDAV_MAX_RESOURCE_SIZE=1048576          # 1MB max per contact
FORGE_CARDDAV_SYNC_TOKEN=true                    # RFC 6578 - Collection Synchronization
FORGE_CARDDAV_DIRECTORY_GATEWAY=true             # Directory gateway support
FORGE_CARDDAV_BULK_OPERATIONS=true               # Bulk vCard operations
FORGE_CARDDAV_PHOTO_SIZE_LIMIT=5242880           # 5MB max for contact photos

# DAV Authentication & Security
FORGE_DAV_REALM=Exprsn Forge DAV
FORGE_DAV_BEARER_AUTH=true                       # Support Bearer token auth
FORGE_DAV_OAUTH2_ENABLED=true                    # Support OAuth2 for DAV
FORGE_DAV_TLS_REQUIRED=false                     # Require TLS (set true in production)
FORGE_DAV_RATE_LIMIT=1000                        # Requests per hour per user

# ───────────────────────────────────────────────────────────────────────
# File Storage & Sharing Configuration
# ───────────────────────────────────────────────────────────────────────

# Storage Backend
FORGE_STORAGE_TYPE=local                         # Options: local, disk, s3, ipfs, hybrid
FORGE_STORAGE_PATH=/var/forge/files
FORGE_MAX_FILE_SIZE=104857600                    # 100MB default
FORGE_MAX_UPLOAD_CHUNK_SIZE=10485760             # 10MB chunks
FORGE_ALLOWED_FILE_TYPES=*                       # Comma-separated or * for all
FORGE_MAX_VERSIONS_PER_FILE=20

# S3 / S3-Compatible Storage (MinIO, DigitalOcean Spaces, Wasabi, etc.)
FORGE_S3_ENABLED=false
FORGE_S3_BUCKET=forge-files
FORGE_S3_REGION=us-east-1
FORGE_S3_ACCESS_KEY_ID=
FORGE_S3_SECRET_ACCESS_KEY=
FORGE_S3_ENDPOINT=                               # Custom endpoint for S3-compatible services
FORGE_S3_PREFIX=forge/                           # S3 key prefix
FORGE_S3_USE_PATH_STYLE=false                    # Use path-style URLs
FORGE_S3_SIGNATURE_VERSION=v4                    # v2 or v4
FORGE_S3_FORCE_PATH_STYLE=false
FORGE_S3_ACL=private                             # private, public-read, public-read-write, authenticated-read

# IPFS (InterPlanetary File System) Configuration
FORGE_IPFS_ENABLED=false
FORGE_IPFS_API_URL=http://localhost:5001         # IPFS daemon API
FORGE_IPFS_GATEWAY_URL=https://ipfs.io           # Public IPFS gateway
FORGE_IPFS_PIN_ENABLED=true                      # Auto-pin uploaded files
FORGE_IPFS_CLUSTER_ENABLED=false                 # Use IPFS Cluster for HA
FORGE_IPFS_CLUSTER_URL=
FORGE_IPFS_PINNING_SERVICE=local                 # local, pinata, web3storage, infura

# Pinata (IPFS Pinning Service)
FORGE_IPFS_PINATA_JWT=

# Web3.Storage (IPFS Pinning Service)
FORGE_IPFS_WEB3STORAGE_TOKEN=

# Local Disk Storage
FORGE_DISK_ENABLED=true
FORGE_DISK_STORAGE_PATH=/var/forge/storage
FORGE_DISK_MAX_SIZE=1099511627776                # 1TB default
FORGE_DISK_QUOTA_ENABLED=true

# Storage Features
FORGE_ENABLE_DEDUPLICATION=true                  # Hash-based deduplication
FORGE_ENABLE_ENCRYPTION_AT_REST=true             # Encrypt files at rest
FORGE_ENABLE_VIRUS_SCANNING=false                # Virus scanning (requires ClamAV/VirusTotal)
FORGE_VIRUS_SCANNER_TYPE=clamav                  # clamav, virustotal, metadefender
FORGE_CLAMAV_HOST=localhost
FORGE_CLAMAV_PORT=3310

# ───────────────────────────────────────────────────────────────────────
# Groupware Settings
# ───────────────────────────────────────────────────────────────────────

# Calendar
FORGE_CALENDAR_MAX_EVENTS_PER_DAY=50
FORGE_CALENDAR_DEFAULT_VIEW=week                 # day, week, month, year, agenda
FORGE_CALENDAR_WEEK_START=0                      # 0=Sunday, 1=Monday
FORGE_CALENDAR_BUSINESS_HOURS_START=09:00
FORGE_CALENDAR_BUSINESS_HOURS_END=17:00
FORGE_CALENDAR_SLOT_DURATION=30                  # Minutes
FORGE_CALENDAR_ENABLE_REMINDERS=true
FORGE_CALENDAR_DEFAULT_REMINDER=15               # Minutes before event

# Tasks
FORGE_TASK_MAX_SUBTASK_DEPTH=5
FORGE_TASK_ENABLE_DEPENDENCIES=true
FORGE_TASK_ENABLE_TIME_TRACKING=true
FORGE_TASK_ENABLE_ESTIMATES=true
FORGE_TASK_DEFAULT_PRIORITY=medium               # low, medium, high, urgent
FORGE_TASK_AUTO_CLOSE_SUBTASKS=false

# Documents
FORGE_DOCUMENT_VERSION_LIMIT=20
FORGE_DOCUMENT_AUTO_SAVE=true
FORGE_DOCUMENT_AUTO_SAVE_INTERVAL=60000          # Milliseconds
FORGE_DOCUMENT_ENABLE_COMMENTS=true
FORGE_DOCUMENT_ENABLE_TEMPLATES=true
FORGE_DOCUMENT_OCR_ENABLED=false
FORGE_DOCUMENT_PREVIEW_ENABLED=true
FORGE_DOCUMENT_COLLABORATIVE_EDITING=true

# Wiki
FORGE_WIKI_ENABLED=true
FORGE_WIKI_MAX_PAGE_SIZE=1048576                 # 1MB
FORGE_WIKI_MARKDOWN_ENABLED=true
FORGE_WIKI_WYSIWYG_EDITOR=true
FORGE_WIKI_PAGE_HISTORY=true
FORGE_WIKI_MAX_HISTORY_VERSIONS=100
FORGE_WIKI_ENABLE_ATTACHMENTS=true
FORGE_WIKI_ENABLE_COMMENTS=true
FORGE_WIKI_ENABLE_TAGS=true

# ───────────────────────────────────────────────────────────────────────
# CRM Settings
# ───────────────────────────────────────────────────────────────────────

FORGE_LEAD_SCORING_ENABLED=true
FORGE_LEAD_SCORING_MODEL=weighted                # simple, weighted, ml
FORGE_AUTO_ASSIGN_LEADS=true
FORGE_LEAD_ASSIGNMENT_STRATEGY=round-robin       # round-robin, territory, load-balanced, manual
FORGE_DUPLICATE_DETECTION=true
FORGE_DUPLICATE_DETECTION_FIELDS=email,phone
FORGE_CONTACT_MERGE_ENABLED=true
FORGE_ENABLE_TERRITORIES=true
FORGE_ENABLE_FORECASTING=true
FORGE_FORECAST_PERIOD=quarterly                  # monthly, quarterly, annually
FORGE_PIPELINE_STAGES_CUSTOM=true
FORGE_DEFAULT_PIPELINE_STAGES=Lead,Qualified,Proposal,Negotiation,Closed Won,Closed Lost
FORGE_OPPORTUNITY_PROBABILITY_AUTO=true
FORGE_EMAIL_TRACKING_ENABLED=true
FORGE_EMAIL_TEMPLATE_VARIABLES=true
FORGE_QUOTE_VERSIONING=true
FORGE_QUOTE_EXPIRY_DAYS=30

# ───────────────────────────────────────────────────────────────────────
# ERP Settings
# ───────────────────────────────────────────────────────────────────────

# Financial
FORGE_MULTI_CURRENCY=true
FORGE_DEFAULT_CURRENCY=USD
FORGE_CURRENCY_AUTO_UPDATE=true
FORGE_CURRENCY_API=fixer                         # fixer, openexchangerates, currencylayer, ecb
FORGE_CURRENCY_API_KEY=
FORGE_FISCAL_YEAR_START=01-01                    # MM-DD format
FORGE_TAX_CALCULATION=true
FORGE_DEFAULT_TAX_RATE=0.00                      # Decimal (0.0825 = 8.25%)
FORGE_TAX_INCLUSIVE_PRICING=false
FORGE_MULTI_TAX_ENABLED=true
FORGE_CHART_OF_ACCOUNTS_TEMPLATE=standard        # standard, manufacturing, retail, services, nonprofit
FORGE_ENABLE_BUDGETING=true
FORGE_ENABLE_COST_CENTERS=true
FORGE_ENABLE_PROJECTS_ACCOUNTING=true

# Inventory
FORGE_INVENTORY_TRACKING=true
FORGE_INVENTORY_METHOD=fifo                      # fifo, lifo, average, specific
FORGE_SERIAL_NUMBER_TRACKING=false
FORGE_BATCH_LOT_TRACKING=true
FORGE_EXPIRY_DATE_TRACKING=true
FORGE_MULTI_LOCATION=true
FORGE_DEFAULT_LOCATION=main
FORGE_STOCK_ALERTS_ENABLED=true
FORGE_REORDER_POINT_AUTO=true
FORGE_ENABLE_WAREHOUSING=true
FORGE_BARCODE_SCANNING=true
FORGE_BARCODE_FORMAT=CODE128                     # EAN13, UPC, CODE128, QR

# Manufacturing (Optional)
FORGE_MANUFACTURING_ENABLED=false
FORGE_BOM_ENABLED=true                           # Bill of Materials
FORGE_BOM_VERSIONING=true
FORGE_WORK_ORDER_ENABLED=true
FORGE_ROUTING_ENABLED=true
FORGE_CAPACITY_PLANNING=true
FORGE_QUALITY_CONTROL=true
FORGE_MRP_ENABLED=false                          # Material Requirements Planning

# Procurement
FORGE_PURCHASE_APPROVAL_WORKFLOW=true
FORGE_PURCHASE_APPROVAL_THRESHOLD=1000
FORGE_VENDOR_PORTAL_ENABLED=true
FORGE_RFQ_ENABLED=true                           # Request for Quotation
FORGE_DROP_SHIPPING=true
FORGE_BLANKET_ORDERS=true

# ───────────────────────────────────────────────────────────────────────
# External Integrations
# ───────────────────────────────────────────────────────────────────────

# Google Workspace
FORGE_GOOGLE_CALENDAR_ENABLED=false
FORGE_GOOGLE_CALENDAR_CLIENT_ID=
FORGE_GOOGLE_CALENDAR_CLIENT_SECRET=
FORGE_GOOGLE_WORKSPACE_ENABLED=false

# Microsoft 365
FORGE_MICROSOFT365_ENABLED=false
FORGE_MICROSOFT365_CLIENT_ID=
FORGE_MICROSOFT365_CLIENT_SECRET=
FORGE_MICROSOFT365_TENANT_ID=

# Accounting Software
FORGE_QUICKBOOKS_ENABLED=false
FORGE_QUICKBOOKS_CLIENT_ID=
FORGE_QUICKBOOKS_CLIENT_SECRET=
FORGE_QUICKBOOKS_ENVIRONMENT=sandbox             # sandbox, production

FORGE_XERO_ENABLED=false
FORGE_XERO_CLIENT_ID=
FORGE_XERO_CLIENT_SECRET=

# Payment Processors
FORGE_STRIPE_ENABLED=false
FORGE_STRIPE_SECRET_KEY=
FORGE_STRIPE_PUBLISHABLE_KEY=
FORGE_STRIPE_WEBHOOK_SECRET=

FORGE_PAYPAL_ENABLED=false
FORGE_PAYPAL_CLIENT_ID=
FORGE_PAYPAL_CLIENT_SECRET=
FORGE_PAYPAL_MODE=sandbox                        # sandbox, live

# Shipping Carriers
FORGE_SHIPPING_ENABLED=false
FORGE_FEDEX_ENABLED=false
FORGE_FEDEX_API_KEY=
FORGE_FEDEX_ACCOUNT_NUMBER=

FORGE_UPS_ENABLED=false
FORGE_UPS_API_KEY=
FORGE_UPS_ACCOUNT_NUMBER=

FORGE_USPS_ENABLED=false
FORGE_USPS_USER_ID=

# ───────────────────────────────────────────────────────────────────────
# Workflow & Automation
# ───────────────────────────────────────────────────────────────────────

FORGE_MAX_WORKFLOW_STEPS=50
FORGE_WORKFLOW_TIMEOUT=300000                    # Milliseconds
FORGE_ENABLE_SCHEDULED_WORKFLOWS=true
FORGE_WORKFLOW_EXECUTION_MODE=async              # sync, async, hybrid
FORGE_WORKFLOW_VERSIONING=true
FORGE_WORKFLOW_TESTING_MODE=true
FORGE_WORKFLOW_AUDIT_LOG=true
FORGE_WORKFLOW_ERROR_HANDLING=retry              # stop, continue, retry
FORGE_WORKFLOW_RETRY_ATTEMPTS=3
FORGE_WORKFLOW_RETRY_DELAY=5000                  # Milliseconds

# ───────────────────────────────────────────────────────────────────────
# Reporting & Analytics
# ───────────────────────────────────────────────────────────────────────

FORGE_REPORT_CACHE_TTL=3600                      # Seconds
FORGE_MAX_REPORT_ROWS=10000
FORGE_ENABLE_REPORT_EXPORT=true
FORGE_REPORT_EXPORT_FORMATS=pdf,xlsx,csv,html
FORGE_REPORT_SCHEDULING=true
FORGE_REPORT_EMAIL_DELIVERY=true
FORGE_REPORT_BUILDER_ENABLED=true
FORGE_REPORT_SQL_ALLOWED=false                   # Allow custom SQL (security risk)
FORGE_DASHBOARD_WIDGETS_MAX=20
FORGE_DASHBOARD_AUTO_REFRESH=true
FORGE_DASHBOARD_REFRESH_INTERVAL=60000           # Milliseconds

# ───────────────────────────────────────────────────────────────────────
# Background Jobs & Scheduling
# ───────────────────────────────────────────────────────────────────────

FORGE_ENABLE_CRON_JOBS=true
FORGE_CRON_BACKUP_SCHEDULE=0 2 * * *             # Daily at 2 AM
FORGE_CRON_CLEANUP_SCHEDULE=0 3 * * *            # Daily at 3 AM
FORGE_CRON_REPORT_SCHEDULE=0 * * * *             # Hourly
FORGE_CRON_SYNC_SCHEDULE=*/15 * * * *            # Every 15 minutes

# ═══════════════════════════════════════════════════════════════════════
# NOTES
# ═══════════════════════════════════════════════════════════════════════
#
# DAV Protocol Support:
# - WebDAV (RFC 4918): Web-based file management
# - CalDAV (RFC 4791): Calendar synchronization (Apple Calendar, Thunderbird, etc.)
# - CardDAV (RFC 6352): Contact synchronization
# - DeltaV (RFC 3253): WebDAV versioning extensions
# - DASL (RFC 5323): WebDAV search extensions
#
# Compatible Clients:
# - CalDAV: Apple Calendar, Thunderbird, Evolution, DAVx⁵, Outlook (with plugins)
# - CardDAV: Apple Contacts, Thunderbird, Evolution, DAVx⁵
# - WebDAV: macOS Finder, Windows Explorer, Cyberduck, WinSCP, Nautilus
#
# IPFS Integration:
# - Decentralized file storage with content addressing
# - Supports pinning services: Pinata, Web3.Storage, Infura
# - Files are accessible via IPFS CID (Content Identifier)
# - Optional IPFS Cluster for high availability
#
# S3-Compatible Services:
# - Amazon S3
# - MinIO (self-hosted)
# - DigitalOcean Spaces
# - Wasabi
# - Backblaze B2
# - Cloudflare R2
#
# ═══════════════════════════════════════════════════════════════════════
