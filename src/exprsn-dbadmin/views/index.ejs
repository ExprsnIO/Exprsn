<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= title %></title>

  <!-- Bootstrap 5.3 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Bootstrap Icons -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">

  <!-- Monaco Editor -->
  <link rel="stylesheet" data-name="vs/editor/editor.main" href="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.min.css">

  <!-- Custom CSS -->
  <link rel="stylesheet" href="/css/dbadmin.css">
</head>
<body>

  <!-- Sidebar -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <a href="/" class="sidebar-brand">
        <i class="bi bi-database"></i>
        DB Admin
      </a>
    </div>

    <nav class="sidebar-nav">
      <!-- Dashboard Section -->
      <div class="nav-section">
        <div class="nav-section-title">Main</div>
        <ul>
          <li class="nav-item">
            <a href="#" class="nav-link active" data-page="dashboard">
              <i class="bi bi-grid-3x3-gap"></i> Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="query">
              <i class="bi bi-code-square"></i> Query Editor
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="connections">
              <i class="bi bi-plugin"></i> Connections
              <span class="nav-badge" id="connectionsCount">0</span>
            </a>
          </li>
        </ul>
      </div>

      <!-- Database Objects Section -->
      <div class="nav-section">
        <div class="nav-section-title">Database Objects</div>
        <ul>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="tablespaces">
              <i class="bi bi-hdd-stack"></i> Tablespaces
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="tables">
              <i class="bi bi-table"></i> Tables
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="indices">
              <i class="bi bi-diagram-3"></i> Indices
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="functions">
              <i class="bi bi-braces"></i> Functions
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="triggers">
              <i class="bi bi-lightning"></i> Triggers
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="sequences">
              <i class="bi bi-arrow-repeat"></i> Sequences
            </a>
          </li>
        </ul>
      </div>

      <!-- Administration Section -->
      <div class="nav-section">
        <div class="nav-section-title">Administration</div>
        <ul>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="users">
              <i class="bi bi-people"></i> Users & Roles
            </a>
          </li>
          <li class="nav-item">
            <a href="#" class="nav-link" data-page="import-export">
              <i class="bi bi-arrow-left-right"></i> Import/Export
            </a>
          </li>
        </ul>
      </div>
    </nav>

    <div class="user-info">
      <small class="text-muted d-block">Logged in as</small>
      <strong>Administrator</strong>
    </div>
  </aside>

  <!-- Main Content -->
  <div class="main-content">
    <!-- Content Header -->
    <div class="content-header">
      <div class="d-flex align-items-center justify-content-between">
        <div>
          <h2 class="mb-0" id="pageTitle">Dashboard</h2>
          <p class="text-muted mb-0" id="pageSubtitle">PostgreSQL Database Administration</p>
        </div>
        <div>
          <div class="dropdown">
            <button class="btn btn-outline-primary dropdown-toggle" type="button" id="connectionDropdown" data-bs-toggle="dropdown">
              <i class="bi bi-server"></i> <span id="currentConnection">Select Connection</span>
            </button>
            <ul class="dropdown-menu dropdown-menu-end" id="connectionDropdownMenu">
              <li><a class="dropdown-item text-muted"><em>No connections</em></a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- Content Body -->
    <div class="content-body">
      <!-- Dashboard Page -->
      <div id="dashboardPage" class="page-content">
        <!-- Stats Row -->
        <div class="row g-3 mb-4">
          <div class="col-md-3 col-sm-6">
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(102, 126, 234, 0.1); color: #667eea;">
                <i class="bi bi-plugin"></i>
              </div>
              <div class="stat-value" id="statConnections">0</div>
              <div class="stat-label">Connections</div>
              <span class="stat-badge badge bg-success" id="statConnectionsOnline">0 Online</span>
            </div>
          </div>
          <div class="col-md-3 col-sm-6">
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(16, 185, 129, 0.1); color: #10b981;">
                <i class="bi bi-table"></i>
              </div>
              <div class="stat-value" id="statTables">-</div>
              <div class="stat-label">Tables</div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6">
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(245, 158, 11, 0.1); color: #f59e0b;">
                <i class="bi bi-braces"></i>
              </div>
              <div class="stat-value" id="statFunctions">-</div>
              <div class="stat-label">Functions</div>
            </div>
          </div>
          <div class="col-md-3 col-sm-6">
            <div class="stat-card">
              <div class="stat-icon" style="background: rgba(239, 68, 68, 0.1); color: #ef4444;">
                <i class="bi bi-clock-history"></i>
              </div>
              <div class="stat-value" id="statQueries">0</div>
              <div class="stat-label">Queries Today</div>
            </div>
          </div>
        </div>

        <!-- Quick Actions -->
        <div class="card mb-4">
          <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-lightning-charge text-warning me-2"></i>Quick Actions</h6>
          </div>
          <div class="card-body">
            <div class="quick-actions">
              <a href="#" class="quick-action-btn" data-action="new-connection">
                <i class="bi bi-plus-circle"></i>
                New Connection
              </a>
              <a href="#" class="quick-action-btn" data-action="query-editor">
                <i class="bi bi-code-square"></i>
                Query Editor
              </a>
              <a href="#" class="quick-action-btn" data-action="import-data">
                <i class="bi bi-upload"></i>
                Import Data
              </a>
              <a href="#" class="quick-action-btn" data-action="export-data">
                <i class="bi bi-download"></i>
                Export Data
              </a>
            </div>
          </div>
        </div>

        <!-- Server Connections Table -->
        <div class="server-table">
          <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-server me-2"></i>Database Servers</h6>
          </div>
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th>Status</th>
                <th>Server Name</th>
                <th>Host</th>
                <th>Port</th>
                <th>Database</th>
                <th>Username</th>
                <th>Version</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody id="serversTableBody">
              <tr>
                <td colspan="8" class="text-center text-muted py-4">
                  <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                  No database connections configured
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Query Editor Page -->
      <div id="queryPage" class="page-content" style="display: none;">
        <!-- Editor Container -->
        <div class="editor-container mb-3">
          <div class="editor-header">
            <ul class="editor-tabs">
              <li class="editor-tab active" data-tab="query1">
                <i class="bi bi-file-earmark-code"></i>
                Query 1
                <span class="close-tab" data-tab="query1">Ã—</span>
              </li>
              <li class="editor-tab" data-action="new-tab">
                <i class="bi bi-plus"></i>
              </li>
            </ul>
            <div class="editor-actions">
              <button class="btn btn-sm btn-success" id="executeBtn" title="Execute (Ctrl+Enter)">
                <i class="bi bi-play-fill"></i> Execute
              </button>
              <button class="btn btn-sm btn-info" id="explainBtn" title="Explain Query">
                <i class="bi bi-info-circle"></i> Explain
              </button>
              <button class="btn btn-sm btn-warning" id="formatBtn" title="Format SQL">
                <i class="bi bi-magic"></i> Format
              </button>
              <button class="btn btn-sm btn-secondary" id="saveBtn" title="Save Query">
                <i class="bi bi-save"></i> Save
              </button>
            </div>
          </div>
          <div id="editor"></div>
        </div>

        <!-- Query Status -->
        <div class="alert alert-info d-none mb-3" id="queryStatus">
          <div class="d-flex align-items-center">
            <div class="spinner-border spinner-border-sm me-2" role="status"></div>
            <span id="queryStatusText">Executing query...</span>
          </div>
        </div>

        <!-- Results Panel -->
        <div class="results-panel">
          <div class="results-header">
            <ul class="nav nav-tabs results-tabs" role="tablist">
              <li class="nav-item">
                <a class="nav-link active" data-bs-toggle="tab" href="#resultsTab">
                  <i class="bi bi-table"></i> Results
                  <span class="badge bg-primary ms-1" id="rowCountBadge">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#messagesTab">
                  <i class="bi bi-chat-square-text"></i> Messages
                  <span class="badge bg-secondary ms-1" id="messageCountBadge">0</span>
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#historyTab">
                  <i class="bi bi-clock-history"></i> History
                </a>
              </li>
              <li class="nav-item">
                <a class="nav-link" data-bs-toggle="tab" href="#explainTab">
                  <i class="bi bi-diagram-2"></i> Explain Plan
                </a>
              </li>
            </ul>
          </div>
          <div class="tab-content">
            <!-- Results Tab -->
            <div class="tab-pane fade show active" id="resultsTab">
              <div class="results-body" id="resultsContainer">
                <div class="text-center text-muted py-5">
                  <i class="bi bi-play-circle fs-1 d-block mb-3"></i>
                  <p>Execute a query to see results</p>
                  <small>Tip: Use Ctrl+Enter to execute</small>
                </div>
              </div>
              <div class="custom-pagination d-none" id="resultsPagination">
                <div class="pagination-info">
                  Showing <span id="paginationStart">0</span> to <span id="paginationEnd">0</span> of <span id="paginationTotal">0</span> rows
                </div>
                <ul class="pagination mb-0" id="paginationControls">
                  <li class="page-item disabled"><a class="page-link" href="#">Previous</a></li>
                  <li class="page-item active"><a class="page-link" href="#">1</a></li>
                  <li class="page-item"><a class="page-link" href="#">Next</a></li>
                </ul>
              </div>
            </div>

            <!-- Messages Tab -->
            <div class="tab-pane fade" id="messagesTab">
              <div class="results-body" id="messagesContainer">
                <p class="text-muted">No messages</p>
              </div>
            </div>

            <!-- History Tab -->
            <div class="tab-pane fade" id="historyTab">
              <div class="results-body" id="historyContainer">
                <table class="table table-hover table-sm">
                  <thead>
                    <tr>
                      <th>Time</th>
                      <th>Query</th>
                      <th>Duration</th>
                      <th>Rows</th>
                      <th>Status</th>
                    </tr>
                  </thead>
                  <tbody id="historyTableBody">
                    <tr>
                      <td colspan="5" class="text-center text-muted">No query history</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>

            <!-- Explain Plan Tab -->
            <div class="tab-pane fade" id="explainTab">
              <div class="results-body" id="explainContainer">
                <p class="text-muted">Click "Explain" button to see query execution plan</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Tables Page -->
      <div id="tablesPage" class="page-content" style="display: none;">
        <div class="card">
          <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h6 class="mb-0"><i class="bi bi-table me-2"></i>Tables</h6>
            <button class="btn btn-sm btn-primary" id="newTableBtn">
              <i class="bi bi-plus"></i> New Table
            </button>
          </div>
          <div class="card-body">
            <div class="table-responsive">
              <table class="table table-hover" id="tablesTable">
                <thead>
                  <tr>
                    <th>Schema</th>
                    <th>Table Name</th>
                    <th>Rows</th>
                    <th>Size</th>
                    <th>Columns</th>
                    <th>Indices</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="tablesTableBody">
                  <tr>
                    <td colspan="7" class="text-center text-muted">Select a connection to view tables</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <!-- Other Pages (Placeholder Structure) -->
      <div id="tablespacesPage" class="page-content" style="display: none;">
        <div class="card">
          <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-hdd-stack me-2"></i>Tablespaces</h6>
          </div>
          <div class="card-body">
            <p class="text-muted">Tablespace management interface</p>
          </div>
        </div>
      </div>

      <div id="indicesPage" class="page-content" style="display: none;">
        <div class="card">
          <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-diagram-3 me-2"></i>Indices</h6>
          </div>
          <div class="card-body">
            <p class="text-muted">Index management interface</p>
          </div>
        </div>
      </div>

      <div id="functionsPage" class="page-content" style="display: none;">
        <div class="card">
          <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-braces me-2"></i>Functions & Stored Procedures</h6>
          </div>
          <div class="card-body">
            <p class="text-muted">Function management interface</p>
          </div>
        </div>
      </div>

      <div id="triggersPage" class="page-content" style="display: none;">
        <div class="card">
          <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-lightning me-2"></i>Triggers</h6>
          </div>
          <div class="card-body">
            <p class="text-muted">Trigger management interface</p>
          </div>
        </div>
      </div>

      <div id="sequencesPage" class="page-content" style="display: none;">
        <div class="card">
          <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-arrow-repeat me-2"></i>Sequences</h6>
          </div>
          <div class="card-body">
            <p class="text-muted">Sequence management interface</p>
          </div>
        </div>
      </div>

      <div id="usersPage" class="page-content" style="display: none;">
        <div class="card">
          <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-people me-2"></i>Users & Roles</h6>
          </div>
          <div class="card-body">
            <p class="text-muted">User and role management interface</p>
          </div>
        </div>
      </div>

      <div id="import-exportPage" class="page-content" style="display: none;">
        <div class="card">
          <div class="card-header bg-light">
            <h6 class="mb-0"><i class="bi bi-arrow-left-right me-2"></i>Import/Export</h6>
          </div>
          <div class="card-body">
            <p class="text-muted">Data import/export interface</p>
          </div>
        </div>
      </div>

      <div id="connectionsPage" class="page-content" style="display: none;">
        <div class="card">
          <div class="card-header bg-light d-flex justify-content-between align-items-center">
            <h6 class="mb-0"><i class="bi bi-plugin me-2"></i>Database Connections</h6>
            <button class="btn btn-sm btn-primary" id="addConnectionBtn">
              <i class="bi bi-plus"></i> New Connection
            </button>
          </div>
          <div class="card-body">
            <div id="connectionsList"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading Overlay -->
  <div class="loading-overlay d-none" id="loadingOverlay">
    <div class="loading-spinner"></div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Socket.IO Client -->
  <script src="/socket.io/socket.io.js"></script>

  <!-- Monaco Editor -->
  <script>var require = { paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs' } };</script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/loader.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.nls.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.45.0/min/vs/editor/editor.main.js"></script>

  <!-- Main Application Script -->
  <script src="/js/app.js"></script>

</body>
</html>
