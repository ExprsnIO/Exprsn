<!DOCTYPE html>
<html lang="en" data-bs-theme="auto">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Authentication Setup - Exprsn</title>

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css" rel="stylesheet">

  <style>
    :root {
      --exprsn-primary: #2563eb;
      --exprsn-primary-dark: #1e40af;
      --exprsn-gradient-start: #667eea;
      --exprsn-gradient-end: #764ba2;
    }

    body {
      background: #f8f9fa;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    }

    .navbar-custom {
      background: linear-gradient(135deg, var(--exprsn-gradient-start) 0%, var(--exprsn-gradient-end) 100%);
      color: white;
      padding: 1rem 0;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
    }

    .navbar-custom .navbar-brand {
      color: white;
      font-weight: 700;
      font-size: 1.5rem;
    }

    .content-container {
      max-width: 1400px;
      margin: 2rem auto;
      padding: 0 20px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
    }

    .stat-card {
      background: white;
      border-radius: 12px;
      padding: 1.5rem;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      transition: transform 0.2s;
    }

    .stat-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.12);
    }

    .stat-card .icon {
      font-size: 2rem;
      margin-bottom: 0.5rem;
    }

    .stat-card h3 {
      font-size: 2rem;
      font-weight: 700;
      margin: 0.5rem 0;
      color: #212529;
    }

    .stat-card p {
      margin: 0;
      color: #6c757d;
      font-size: 0.9rem;
    }

    .setup-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
      overflow: hidden;
    }

    .nav-tabs {
      border-bottom: 2px solid #dee2e6;
      background: #f8f9fa;
      padding: 0.5rem 1.5rem 0;
    }

    .nav-tabs .nav-link {
      border: none;
      color: #6c757d;
      padding: 1rem 1.5rem;
      font-weight: 500;
      border-radius: 8px 8px 0 0;
      margin-right: 0.5rem;
    }

    .nav-tabs .nav-link:hover {
      color: var(--exprsn-primary);
      background: rgba(102, 126, 234, 0.1);
    }

    .nav-tabs .nav-link.active {
      color: var(--exprsn-primary);
      background: white;
      border-bottom: 3px solid var(--exprsn-primary);
    }

    .tab-content {
      padding: 2rem;
    }

    .form-section {
      margin-bottom: 2rem;
    }

    .form-section h3 {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: 1rem;
      padding-bottom: 0.5rem;
      border-bottom: 2px solid #dee2e6;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--exprsn-gradient-start) 0%, var(--exprsn-gradient-end) 100%);
      border: none;
      padding: 0.625rem 1.5rem;
      font-weight: 600;
      border-radius: 8px;
      transition: transform 0.2s, box-shadow 0.2s;
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.4);
    }

    .list-group-item {
      border-left: 3px solid transparent;
      transition: all 0.2s;
    }

    .list-group-item:hover {
      border-left-color: var(--exprsn-primary);
      background-color: rgba(102, 126, 234, 0.05);
    }

    .badge {
      padding: 0.35rem 0.75rem;
      font-weight: 600;
      border-radius: 6px;
    }

    .code-block {
      background: #1e1e1e;
      color: #d4d4d4;
      padding: 1rem;
      border-radius: 8px;
      font-family: 'Courier New', monospace;
      font-size: 0.875rem;
      overflow-x: auto;
      margin: 1rem 0;
    }

    .alert {
      border-radius: 8px;
      border: none;
    }

    .modal-content {
      border-radius: 12px;
    }

    .table-container {
      overflow-x: auto;
    }

    .status-dot {
      display: inline-block;
      width: 8px;
      height: 8px;
      border-radius: 50%;
      margin-right: 6px;
    }

    .status-dot.success { background-color: #28a745; }
    .status-dot.warning { background-color: #ffc107; }
    .status-dot.danger { background-color: #dc3545; }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar-custom">
    <div class="container-fluid px-4">
      <span class="navbar-brand">
        <i class="bi bi-gear-fill"></i> Exprsn Authentication Setup
      </span>
      <div class="d-flex gap-2">
        <a href="/admin" class="btn btn-light btn-sm">
          <i class="bi bi-speedometer2"></i> Admin
        </a>
        <a href="/login" class="btn btn-light btn-sm">
          <i class="bi bi-box-arrow-in-right"></i> Login
        </a>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="content-container">
    <!-- Statistics Overview -->
    <div class="stats-grid">
      <div class="stat-card">
        <div class="icon text-primary"><i class="bi bi-people-fill"></i></div>
        <h3><%= stats.users %></h3>
        <p>Total Users</p>
      </div>
      <div class="stat-card">
        <div class="icon text-success"><i class="bi bi-diagram-3-fill"></i></div>
        <h3><%= stats.groups %></h3>
        <p>User Groups</p>
      </div>
      <div class="stat-card">
        <div class="icon text-info"><i class="bi bi-shield-check"></i></div>
        <h3><%= stats.roles %></h3>
        <p>Roles</p>
      </div>
      <div class="stat-card">
        <div class="icon text-warning"><i class="bi bi-key-fill"></i></div>
        <h3><%= stats.oauth2Clients %></h3>
        <p>OAuth2 Clients</p>
      </div>
      <div class="stat-card">
        <div class="icon text-danger"><i class="bi bi-building"></i></div>
        <h3><%= stats.organizations %></h3>
        <p>Organizations</p>
      </div>
    </div>

    <!-- Tabbed Setup Interface -->
    <div class="setup-card">
      <ul class="nav nav-tabs" id="setupTabs" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="system-tab" data-bs-toggle="tab" data-bs-target="#system" type="button">
            <i class="bi bi-gear"></i> System
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="oidc-tab" data-bs-toggle="tab" data-bs-target="#oidc" type="button">
            <i class="bi bi-shield-lock"></i> OpenID Connect
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="oauth2-tab" data-bs-toggle="tab" data-bs-target="#oauth2" type="button">
            <i class="bi bi-key"></i> OAuth2 Clients
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="saml-tab" data-bs-toggle="tab" data-bs-target="#saml" type="button">
            <i class="bi bi-diagram-2"></i> SAML/SSO
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="users-tab" data-bs-toggle="tab" data-bs-target="#users" type="button">
            <i class="bi bi-person-plus"></i> Users
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="groups-tab" data-bs-toggle="tab" data-bs-target="#groups" type="button">
            <i class="bi bi-people"></i> Groups
          </button>
        </li>
        <li class="nav-item" role="presentation">
          <button class="nav-link" id="roles-tab" data-bs-toggle="tab" data-bs-target="#roles" type="button">
            <i class="bi bi-shield"></i> Roles
          </button>
        </li>
      </ul>

      <div class="tab-content" id="setupTabContent">
        <%- include('setup/system-tab', { caStatus, oidcIssuer }) %>
        <%- include('setup/oidc-tab', { oidcIssuer }) %>
        <%- include('setup/oauth2-tab') %>
        <%- include('setup/saml-tab') %>
        <%- include('setup/users-tab') %>
        <%- include('setup/groups-tab') %>
        <%- include('setup/roles-tab') %>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Setup Scripts -->
  <script>
    // API helper
    const api = {
      async get(url) {
        const response = await fetch(url);
        return response.json();
      },
      async post(url, data) {
        const response = await fetch(url, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(data)
        });
        return response.json();
      },
      async delete(url) {
        const response = await fetch(url, { method: 'DELETE' });
        return response.json();
      }
    };

    // Show alert
    function showAlert(message, type = 'success') {
      const alertDiv = document.createElement('div');
      alertDiv.className = `alert alert-${type} alert-dismissible fade show`;
      alertDiv.innerHTML = `
        ${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
      `;
      document.querySelector('.content-container').insertBefore(alertDiv, document.querySelector('.stats-grid'));
      setTimeout(() => alertDiv.remove(), 5000);
    }

    // Copy to clipboard
    function copyToClipboard(text, button) {
      navigator.clipboard.writeText(text);
      const originalText = button.innerHTML;
      button.innerHTML = '<i class="bi bi-check"></i> Copied!';
      setTimeout(() => button.innerHTML = originalText, 2000);
    }
  </script>
</body>
</html>
