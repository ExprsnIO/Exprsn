<!-- Groups Tab -->
<div class="tab-pane fade" id="groups" role="tabpanel">
  <div class="d-flex justify-content-between align-items-center mb-3">
    <h3><i class="bi bi-people"></i> User Groups</h3>
    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#createGroupModal">
      <i class="bi bi-plus-circle"></i> Create Group
    </button>
  </div>

  <div id="groupsList">
    <p class="text-muted">Loading groups...</p>
  </div>
</div>

<!-- Create Group Modal -->
<div class="modal fade" id="createGroupModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title"><i class="bi bi-people"></i> Create Group</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
      </div>
      <form id="createGroupForm">
        <div class="modal-body">
          <div class="mb-3">
            <label class="form-label">Group Name *</label>
            <input type="text" class="form-control" name="name" required>
          </div>
          <div class="mb-3">
            <label class="form-label">Description</label>
            <textarea class="form-control" name="description" rows="2"></textarea>
          </div>
          <div class="mb-3">
            <label class="form-label">Group Type</label>
            <select class="form-select" name="type">
              <option value="custom">Custom</option>
              <option value="organization">Organization</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
          <button type="submit" class="btn btn-primary">Create Group</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.getElementById('createGroupForm').addEventListener('submit', async (e) => {
  e.preventDefault();
  const formData = new FormData(e.target);
  const data = Object.fromEntries(formData);

  const result = await api.post('/setup/api/groups', data);
  if (result.success) {
    bootstrap.Modal.getInstance(document.getElementById('createGroupModal')).hide();
    showAlert('Group created successfully!', 'success');
    loadGroups();
    e.target.reset();
  } else {
    showAlert('Failed to create group: ' + result.error, 'danger');
  }
});

async function loadGroups() {
  const result = await api.get('/setup/api/groups');
  if (result.success) {
    const groups = result.data;
    const html = groups.length > 0 ? `
      <div class="list-group">
        ${groups.map(g => `
          <div class="list-group-item">
            <div class="d-flex w-100 justify-content-between align-items-center">
              <div>
                <h6 class="mb-1">${g.name}</h6>
                <small class="text-muted">${g.description || 'No description'}</small>
                <div class="mt-1">
                  <span class="badge bg-info">${g.type}</span>
                  <span class="badge bg-secondary">${g.members?.length || 0} members</span>
                </div>
              </div>
            </div>
          </div>
        `).join('')}
      </div>
    ` : '<p class="text-muted">No groups yet. Create one to organize users.</p>';
    document.getElementById('groupsList').innerHTML = html;
  }
}

document.getElementById('groups-tab').addEventListener('shown.bs.tab', loadGroups);
</script>
