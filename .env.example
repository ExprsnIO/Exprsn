# ═══════════════════════════════════════════════════════════════════════
# Exprsn Certificate Authority - Environment Configuration
# ═══════════════════════════════════════════════════════════════════════

# ───────────────────────────────────────────────────────────────────────
# Application Settings
# ───────────────────────────────────────────────────────────────────────
NODE_ENV=development
PORT=3000
HOST=0.0.0.0
CLUSTER_ENABLED=false
CLUSTER_WORKERS=4

# Auto-start Services (when running npm start)
# If not set, all production-ready services will start automatically
# Production services: ca,setup,timeline,nexus,prefetch,bridge,pulse,vault
# Development services: auth,spark,moderator,filevault,gallery,live
# Example: AUTO_START_SERVICES=ca,setup,timeline,bridge
# AUTO_START_SERVICES=

# ───────────────────────────────────────────────────────────────────────
# Certificate Authority Settings
# ───────────────────────────────────────────────────────────────────────
CA_NAME=Exprsn Root CA
CA_DOMAIN=localhost
CA_COUNTRY=US
CA_STATE=California
CA_LOCALITY=San Francisco
CA_ORGANIZATION=Exprsn IO
CA_ORGANIZATIONAL_UNIT=Certificate Authority
CA_EMAIL=ca@exprsn.io

# Root Certificate Validity (in days)
CA_ROOT_VALIDITY_DAYS=7300
# Intermediate Certificate Validity (in days)
CA_INTERMEDIATE_VALIDITY_DAYS=3650
# End Entity Certificate Validity (in days)
CA_ENTITY_VALIDITY_DAYS=365

# Key Sizes (in bits)
CA_ROOT_KEY_SIZE=4096
CA_INTERMEDIATE_KEY_SIZE=4096
CA_ENTITY_KEY_SIZE=2048

# ───────────────────────────────────────────────────────────────────────
# Storage Configuration
# ───────────────────────────────────────────────────────────────────────
# Options: disk, s3, postgresql
STORAGE_TYPE=disk

# Disk Storage
STORAGE_DISK_PATH=./data/ca
STORAGE_DISK_CERTS_PATH=./data/ca/certs
STORAGE_DISK_KEYS_PATH=./data/ca/keys
STORAGE_DISK_CRL_PATH=./data/ca/crl
STORAGE_DISK_OCSP_PATH=./data/ca/ocsp

# S3 Storage
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=
S3_BUCKET_NAME=exprsn-ca-certificates
S3_BUCKET_PREFIX=ca/

# ───────────────────────────────────────────────────────────────────────
# Database Configuration (PostgreSQL)
# ───────────────────────────────────────────────────────────────────────
DB_HOST=localhost
DB_PORT=5432
DB_NAME=exprsn_ca
DB_USER=exprsn_ca_user
DB_PASSWORD=
DB_SSL=false
DB_POOL_MIN=2
DB_POOL_MAX=10

# ───────────────────────────────────────────────────────────────────────
# Redis Cache Configuration
# ───────────────────────────────────────────────────────────────────────
REDIS_ENABLED=true
REDIS_HOST=localhost
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_DB=0
REDIS_KEY_PREFIX=exprsn:ca:

# Cache TTL (in seconds)
CACHE_TOKEN_TTL=60
CACHE_CERT_TTL=300
CACHE_OCSP_TTL=300

# ───────────────────────────────────────────────────────────────────────
# JWT Configuration
# ───────────────────────────────────────────────────────────────────────
# JWT Private Key (RSA 4096-bit, base64-encoded PEM)
JWT_PRIVATE_KEY=

# JWT Public Key (RSA 4096-bit, base64-encoded PEM)
JWT_PUBLIC_KEY=

# JWT Token Settings
JWT_ISSUER=exprsn-ca
JWT_ALGORITHM=RS256
JWT_ACCESS_TOKEN_EXPIRY=3600
JWT_REFRESH_TOKEN_EXPIRY=2592000

# ───────────────────────────────────────────────────────────────────────
# Session Configuration
# ───────────────────────────────────────────────────────────────────────
SESSION_SECRET=
SESSION_MAX_AGE=86400000
SESSION_SECURE=false
SESSION_SAME_SITE=lax

# ───────────────────────────────────────────────────────────────────────
# OCSP Configuration
# ───────────────────────────────────────────────────────────────────────
OCSP_ENABLED=true
OCSP_PORT=2560
OCSP_URL=http://localhost:2560
OCSP_BATCH_ENABLED=true
OCSP_BATCH_TIMEOUT=100
OCSP_CACHE_ENABLED=true
OCSP_CACHE_TTL=300

# ───────────────────────────────────────────────────────────────────────
# CRL Configuration
# ───────────────────────────────────────────────────────────────────────
CRL_ENABLED=true
CRL_URL=http://localhost:3000/crl
CRL_UPDATE_INTERVAL=3600
CRL_NEXT_UPDATE_DAYS=7

# ───────────────────────────────────────────────────────────────────────
# Security Settings
# ───────────────────────────────────────────────────────────────────────
# Password Hashing
BCRYPT_ROUNDS=12

# Rate Limiting
RATE_LIMIT_WINDOW_MS=900000
RATE_LIMIT_MAX_REQUESTS=100

# Ticket Authentication
TICKET_EXPIRY_SECONDS=300
TICKET_MAX_USES=1

# Permission Caching
PERMISSION_CACHE_TTL=300

# ───────────────────────────────────────────────────────────────────────
# Password Reset Configuration
# ───────────────────────────────────────────────────────────────────────
PASSWORD_RESET_EXPIRY_MINUTES=60

# ───────────────────────────────────────────────────────────────────────
# Email Configuration
# ───────────────────────────────────────────────────────────────────────
# Email Provider: smtp, sendgrid, ses, mailgun
EMAIL_PROVIDER=smtp
EMAIL_FROM=noreply@exprsn.io

# SMTP Configuration (for EMAIL_PROVIDER=smtp)
SMTP_HOST=smtp.example.com
SMTP_PORT=587
SMTP_SECURE=false
SMTP_USER=
SMTP_PASSWORD=

# SendGrid Configuration (for EMAIL_PROVIDER=sendgrid)
SENDGRID_API_KEY=

# AWS SES Configuration (for EMAIL_PROVIDER=ses)
AWS_REGION=us-east-1
AWS_ACCESS_KEY_ID=
AWS_SECRET_ACCESS_KEY=

# Mailgun Configuration (for EMAIL_PROVIDER=mailgun)
MAILGUN_API_KEY=
MAILGUN_DOMAIN=

# Application URL (for email links)
APP_URL=http://localhost:3000
FRONTEND_URL=http://localhost:3000

# ───────────────────────────────────────────────────────────────────────
# Token Rotation Configuration
# ───────────────────────────────────────────────────────────────────────
TOKEN_ROTATION_ENABLED=true
TOKEN_ROTATION_SCHEDULE=0 * * * *
TOKEN_ROTATION_THRESHOLD_MINUTES=60
TOKEN_ROTATION_EXTENSION_SECONDS=3600
TOKEN_ROTATION_BATCH_SIZE=10

# ───────────────────────────────────────────────────────────────────────
# Logging
# ───────────────────────────────────────────────────────────────────────
LOG_LEVEL=info
LOG_FILE_ENABLED=true
LOG_FILE_PATH=./logs/exprsn-ca.log
LOG_MAX_SIZE=10m
LOG_MAX_FILES=10
LOG_COMPRESS=true

# ───────────────────────────────────────────────────────────────────────
# Token Specification Integration
# ───────────────────────────────────────────────────────────────────────
TOKEN_VERSION=1.0
TOKEN_MAX_SIZE=65536
TOKEN_CHECKSUM_ALGORITHM=sha256
TOKEN_SIGNATURE_ALGORITHM=RSA-SHA256-PSS

# Default Token Settings
DEFAULT_TOKEN_EXPIRY_TYPE=time
DEFAULT_TOKEN_EXPIRY_SECONDS=3600
DEFAULT_TOKEN_MAX_USES=10

# ───────────────────────────────────────────────────────────────────────
# SAML SSO Configuration
# ───────────────────────────────────────────────────────────────────────
# Enable/Disable SAML
SAML_ENABLED=false

# Service Provider Configuration
SAML_ENTITY_ID=https://auth.exprsn.io
SAML_CALLBACK_URL=http://localhost:3001/api/saml/callback
SAML_LOGOUT_URL=http://localhost:3001/api/saml/logout
SAML_LOGOUT_CALLBACK_URL=http://localhost:3001/api/saml/logout/callback

# Service Provider Certificate and Key (for signing/encryption)
SAML_CERT_PATH=./keys/saml-cert.pem
SAML_KEY_PATH=./keys/saml-key.pem
# Or provide directly as environment variables:
SAML_CERT=
SAML_PRIVATE_KEY=

# Signature Configuration
SAML_WANT_ASSERTIONS_SIGNED=true
SAML_WANT_RESPONSE_SIGNED=true

# Identity Provider Configuration (Default IdP)
SAML_IDP_NAME=Default IdP
SAML_IDP_ENTITY_ID=
SAML_IDP_SSO_URL=
SAML_IDP_SLO_URL=
SAML_IDP_CERT_PATH=./keys/idp-cert.pem
# Or provide directly:
SAML_IDP_CERT=

# Alternative: Load IdP metadata from URL
SAML_IDP_METADATA_URL=

# Multiple IdPs: Use JSON config file
SAML_IDP_CONFIG_PATH=./config/saml-idps.json

# Attribute Mapping (map SAML attributes to user fields)
SAML_ATTR_EMAIL=http://schemas.xmlsoap.org/ws/2005/05/identity/claims/emailaddress
SAML_ATTR_FIRST_NAME=http://schemas.xmlsoap.org/ws/2005/05/identity/claims/givenname
SAML_ATTR_LAST_NAME=http://schemas.xmlsoap.org/ws/2005/05/identity/claims/surname
SAML_ATTR_DISPLAY_NAME=http://schemas.xmlsoap.org/ws/2005/05/identity/claims/name
SAML_ATTR_GROUPS=http://schemas.xmlsoap.org/claims/Group
SAML_ATTR_ORG_ID=organizationId

# SAML Options
SAML_AUTO_PROVISION=true
SAML_UPDATE_ON_LOGIN=true
SAML_REQUIRE_EMAIL_VERIFICATION=false
SAML_DEFAULT_ORG_ID=
SAML_MAP_GROUPS=false
SAML_SESSION_LIFETIME=3600000

# ───────────────────────────────────────────────────────────────────────
# Auth Service Configuration (Additional)
# ───────────────────────────────────────────────────────────────────────
AUTH_SERVICE_PORT=3001
AUTH_SERVICE_HOST=localhost
AUTH_DB_HOST=localhost
AUTH_DB_PORT=5432
AUTH_DB_NAME=exprsn_auth
AUTH_DB_USER=postgres
AUTH_DB_PASSWORD=
SESSION_SECRET=
SESSION_LIFETIME=3600000
SESSION_IDLE_TIMEOUT=900000

# OAuth2 Providers
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_CALLBACK_URL=http://localhost:3001/api/auth/google/callback

GITHUB_CLIENT_ID=
GITHUB_CLIENT_SECRET=
GITHUB_CALLBACK_URL=http://localhost:3001/api/auth/github/callback

# CA Integration
CA_URL=http://localhost:3000
AUTH_CA_DOMAIN=auth.exprsn.io
AUTH_CERT_SERIAL=
AUTH_PRIVATE_KEY_PATH=
AUTH_CERTIFICATE_PATH=
CA_ROOT_CERT_PATH=
OCSP_RESPONDER_URL=http://localhost:2560
